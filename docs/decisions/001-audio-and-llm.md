# ADR-001: Выбор технологий захвата аудио и LLM

**Статус**: Принято  
**Дата**: 2026-01-27

## Контекст

Для VoiceCoPilot нужно:
1. Захватывать аудио микрофона (голос пользователя).
2. Захватывать системный звук (голос собеседника из Zoom/Meet/etc).
3. Распознавать речь с минимальной задержкой.
4. Генерировать подсказки через LLM (обход блокировки IP).

## Решения

### Захват аудио

| Задача | Библиотека | Обоснование |
|--------|-----------|-------------|
| Системный звук (loopback) | `wasapi-rs` 0.22+ | Нативный WASAPI loopback, пример в репозитории |
| Микрофон | `cpal` 0.17+ | Кроссплатформенная, но на Windows использует WASAPI |

**Альтернатива**: использовать только `cpal` для обоих источников — но loopback через cpal нестабилен на Windows.

### STT (Speech-to-Text)

| Вариант | Задержка | Стоимость | Выбор |
|---------|----------|-----------|-------|
| `faster-whisper` (локально) | ~0.5-1.5 с на GPU/CPU | Бесплатно | **Основной** |
| OpenAI Whisper API | ~1-2 с | $0.006/мин | Fallback |
| Deepgram | ~0.3 с | $0.0043/мин | Fallback |

**Решение**: `faster-whisper` локально (модель `base` или `small` для скорости), с облачным fallback при ошибках.

### LLM

| Модель | Input/1M | Output/1M | Контекст | Применение |
|--------|----------|-----------|----------|------------|
| Gemini 2.0 Flash | $0.10 | $0.40 | 1M | Быстрые подсказки |
| Gemini 2.5 Flash | $0.30 | $2.50 | 1M | Сложные резюме/ресерч |

**Решение**: OpenRouter как единая точка входа. Gemini 2.0 Flash по умолчанию (дешевле), переключение на 2.5 для сложных запросов.

## Последствия

- Нужна Windows для полноценного loopback.
- Требуется GPU или быстрый CPU для локального STT.
- Нужен ключ OpenRouter (бесплатный тариф ограничен).

## Ссылки

- [wasapi-rs](https://github.com/HEnquist/wasapi-rs)
- [cpal](https://github.com/RustAudio/cpal)
- [faster-whisper](https://github.com/SYSTRAN/faster-whisper)
- [OpenRouter](https://openrouter.ai/)
