# ADR-004: Модель STT gpt-4o-mini-transcribe и порог тишины RMS

**Статус**: Принято  
**Дата**: 2026-01-28

## Контекст

Галлюцинации Whisper на тишине и коротких чанках (ADR-003) снижаются фильтром по паттернам, но запросы к API на тихих чанках всё равно выполняются. Нужно уменьшить число таких запросов и улучшить качество STT.

## Решение

1. **Модель STT по умолчанию** — `gpt-4o-mini-transcribe` (OpenAI). У неё доступны `chunking_strategy="auto"` (server VAD) и меньше галлюцинаций на тишине по сравнению с `whisper-1`. Переключение без кода — через `OPENAI_STT_MODEL` (`gpt-4o-transcribe` для большей точности).
2. **Порог тишины RMS** — параметр `STT_SILENCE_RMS` (по умолчанию 300). Если RMS накопленного чанка ниже порога, OpenAI не вызывается, буфер очищается, возвращается пустой результат. Типичный диапазон 200–400; 0 отключает проверку.
3. **chunking_strategy** — передаётся в API только для моделей `gpt-4o-*`; для `whisper-1` параметр не поддерживается.

## Последствия

- Меньше вызовов API на тишине и меньше «фраз-галлюцинаций» в транскрипте.
- Выбор модели и порога тишины настраивается через переменные окружения.

## Ссылки

- [Create transcription](https://platform.openai.com/docs/api-reference/audio/createTranscription) — модели и параметры `chunking_strategy`.
